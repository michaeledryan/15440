#! /bin/bash

DIR=$(dirname $0)
LOGS=$DIR/../logs
JAR=RMI.jar
EXECUTABLE=$DIR/../build/libs/$JAR

if [ ! -d $LOGS ]
then
    mkdir $LOGS
fi

rm $LOGS/*.log

echo "Starting registry. Logs are in logs/."
java -cp $EXECUTABLE registry.RegistryImpl > $LOGS/registry_stdout.log 2> registry_stderr.log &
sleep 1
echo "Starting server. Logs are in logs/."
java -cp $EXECUTABLE tests/TestServer -t test1 > $LOGS/server_stdout.log 2> server_stderr.log &
sleep 1
echo "Starting client. Output to stdout/stderr."
$DIR/../bin/client -t test1

echo "Finished!"
echo "Killing registry..."
kill `jps | grep "RegistryImpl" | awk {'print $1'}`
echo "Killing server..."
kill `jps | grep "TestServer" | awk {'print $1'}`
